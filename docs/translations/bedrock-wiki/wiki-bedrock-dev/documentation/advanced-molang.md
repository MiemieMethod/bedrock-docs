---
title: 高级 MoLang
description: 高级 MoLang。
mentions:
    - Ciosciaa
    - TheItsNameless
---

## 值

-   所有 MoLang 表达式返回一个值，以便进行相等性检查。大多数表达式返回 `0`。值得注意的是，赋值返回分配的值，循环返回循环语句的解析值（如果存在的话）。
-   MoLang 中的所有值实际上都是单精度浮点数。
-   `this` 用于引用字段在评估过程中累积的当前值。它仅在动画中可用，但可能在其他地方也可用。例如，如果一个骨骼的 `x` `scale` 的累积变换为 `62`，那么最终动画中 `x` `scale` 为 `-this` 将解析为 `-62`，取消之前的变换。这在原版动画中有多处使用。在动画上下文之外，`this` 似乎总是解析为 `0`。

### 布尔值

-   MoLang 中可使用布尔值。`true` 解析为 `1`，`false` 解析为 `0`。

### 数字

-   你可以在数字前使用前导 `0`，例如，为了更好地对齐代码。
-   数字可以使用指数表示法，例如 `2.5e2`，其值等于 250。`e` 可以加上 `+` 或 `-` 来指示指数。
-   数字可以以单个 `f` 结尾，通常用于表示浮点值。这在原版代码中很常见，但被认为没有任何功能。

### 字符串

-   字符串使用 `\`（在转义的 JSON 中为 `\\`）作为某种转义符或其他用途。其具体功能尚不清楚。已知后续的两个字符会被传递给自己的子解析器，该解析器在遇到关闭的 `'` 时不会正确退出；这意味着 MoLang 字符串 `"v.type = '\\x';"` 是无效的。`'` 通常在单独使用时是不允许的，因为它表示字符串的结束，但在 `\` 后的两个字符中是允许的。
-   字符串值（大部分）是增量的，因为它们相对于浮点数表示。可以使用相等或比较运算符比较两个单字符字符串，甚至有效地“调整”单字符字符串的内容。多字符字符串的行为尚不清楚。

## 运算符

完整的优先级列表，从第一个到最后一个评估：

1. `()` 和 `[]`
2. `->`
3. `!` 和 `-`（一元否定）
4. `*` 和 `/`
5. `+` 和 `-`（二元减法）
6. `<`、`<=`、`>` 和 `>=`
7. `==` 和 `!=`
8. `&&`
9. `||`
10. `?` 和 `? :`
11. `??`
12. `=`
13. `return`

-   除条件运算符外，所有运算符均从左到右考虑。
-   同一语句中不能使用多个 `->`。
-   逻辑运算符具有短路特性。

## 语句

-   赋值返回分配的值。因此，如果需要从单个值中处理多个变量，可以链式赋值，例如 `v.iterator_x = (v.iterator_z = math.random_integer(16, 32));`。
-   大括号作用域内的最后一个语句不需要以 `;` 结束。
-   大括号作用域可以在任何表达式可以使用的地方使用。例如，`v.spawn_point ?? {v.target = false;};` 将在 `v.spawn_point` 未定义时将 `v.target` 设置为 `false`。

## 集合

-   实体可迭代对象（例如 `q.get_nearby_entities` 的结果）是其自己的“类型”。它们与下标不兼容。
-   数组同样与实体可迭代操作不兼容，例如 `q.count`。
-   数组下标的结果不能直接作为 `+`、`-`、`*` 或 `/` 的参数，但仍可以直接作为函数参数（甚至是数学函数）或与其他运算符一起使用。

## 评估

-   `initialize` 和 `pre_animation` 是懒惰连接的。这些数组中的 MoLang 字符串必须独立语法有效，但所有独立字符串的基本连接也必须是有效的 MoLang 输入。

## 限制

-   MoLang 在任何语言功能上没有显示出合理的限制，除了数字大小。循环计数、字符串长度、MoLang 输入长度、集合大小等在非常不合理的情况下都被观察到保持有效。