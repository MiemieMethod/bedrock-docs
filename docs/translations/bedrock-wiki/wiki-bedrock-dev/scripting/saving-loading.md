---
title: 数据保存与加载
category: 旧版脚本
tags:
    - 过时
mentions:
    - SirLich
    - Dreamedc2015
    - destruc7ion
    - Paty007gr
    - Fabrimat
    - Herobrine643928
    - JaylyDev
    - SmokeyStack
description: 保存和加载脚本数据。
---

:::danger 停止！

此脚本 API 不再支持。请参考新的 [脚本 API](/scripting/starting-scripts)。

:::

在基岩版中，保存和加载数据是比较棘手的，因为脚本无法直接访问本地文件系统。

尽管如此，我们可以通过 [标记](https://www.youtube.com/watch?v=tjragqkAlMc) 一个 [虚拟实体](/entities/dummy-entities) 来保存数据。

有关 `executeCommand` 和 `broadcastEvent` 函数的详细信息，请 [点击这里](https://bedrock.dev/docs/stable/Scripting)。

请务必注意如何创建自定义事件。

我们将使用 `executeCommand` 来创建和修改标签——请注意，此函数只能在服务器脚本中调用。

对于保存标签，您可以使用一个标签、一个包含所有数据的 JSON 字符串，或者多个标签并记住它们的顺序。我选择使用一个 JSON 字符串，这样我就不需要记住任何内容，因为键会告诉我值的含义。

如果您的数据需要显示给用户，请确保他们先进入世界！例如，您可以为 `"minecraft:client_entered_world"` 设置一个监听器。

在基岩版中，我们可以创建或监听事件，但我们不会直接将事件发送给特定的消费者。只需记住在需要的地方设置监听器和广播事件。例如，如果我想让客户端处理加载的数据，我会这样做：
客户端 -> 服务器 -> 客户端

客户端广播一个事件，服务器监听该事件

并且

服务器广播一个事件，客户端监听该事件，以便可以回复。

## 保存

1. 将 [虚拟实体教程](/entities/dummy-entities) 中的虚拟 JSON 文件添加到您的行为包和资源包中。
2. 在您的服务器脚本中添加一个保存函数，调用 `executeCommand`。此函数将检查虚拟实体是否已创建。如果没有，它将创建该实体并保存数据。
3. 在服务器的初始化函数中添加一个监听器，该监听器将监听客户端脚本广播的保存事件。在这里调用您的保存代码。
4. 在您的客户端中广播一个事件，以通知服务器何时需要保存数据。

## 加载

1. 在服务器脚本的初始化调用中添加一个监听器。该监听器将用于处理来自客户端的加载请求，并在读取后广播保存的数据。
2. 在您的客户端脚本中，您需要广播一个加载事件，以通知服务器需要保存的数据。
3. 在您的客户端脚本中，添加一个监听器以接收服务器读取的保存数据。

## 样板代码

示例代码即将发布...